<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>لوحة المدير</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
<div class="container">
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <div class="h1">لوحة المدير</div>
        <div class="small" id="me"></div>
      </div>
      <div class="row">
        <a class="pill" href="/display/" target="_blank">فتح شاشة العرض</a>
        <a class="pill" href="/staff/" target="_blank">فتح شاشة الفاحص</a>
        <a class="pill" href="/login/">تسجيل دخول</a>
      </div>
    </div>

    <hr>

    <div class="box small">
      ✅ ملاحظة مهمة: “رفع/تصوير صورة للشاشة” لن يعمل الآن لأن الـ API عندك يرجع <b>NOT_FOUND</b> للمسار الخاص بالصورة.
      <br>بعد ما نثبت النظام بالكامل، أضيف لك API للصورة وتشتغل من صلاحية المدير فقط.
    </div>

    <div class="row" style="margin-top:12px">
      <button id="btnCheck">تأكد من API</button>
      <span class="pill" id="st">جاهز</span>
    </div>

    <div class="footer">جميع الحقوق محفوظة للرقيب أول يحيى آل عبدالسلام</div>
  </div>
</div>

<script src="/app.js"></script>
<script>
  const st = document.getElementById("st");
  const me = document.getElementById("me");
  const who = App.getMe();
  me.textContent = "المستخدم: " + (who.username||"-") + " | الصلاحية: " + (who.role||"-");

  if (who.role !== "admin") {
    App.setStatus(st, "تنبيه: هذه الصفحة للمدير فقط", false);
  }

  document.getElementById("btnCheck").addEventListener("click", async ()=>{
    try{
      const r = await App.API.health();
      App.setStatus(st, (r && r.ok) ? "API متصل ✅" : "API غير متصل", !!(r && r.ok));
    }catch(e){
      App.setStatus(st, "API غير متصل", false);
    }
  });
</script>
</body>
</html>
