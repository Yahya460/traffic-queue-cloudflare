<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>لوحة المدير</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>

<script>
(function(){
  const role = localStorage.getItem("role");
  const username = localStorage.getItem("username");

  // لو ما في صلاحية: رجّعه لتسجيل الدخول
  if(role !== "admin" || !username){
    location.href = "/login/";
  }
})();
</script>

<div class="container">
  <div class="card">
    <div class="h1">لوحة المدير</div>
    <div class="small">المستخدم: <b id="u"></b> | الصلاحية: <b>admin</b></div>

    <div class="row gap" style="margin-top:12px;">
      <button onclick="location.href='/login/'">تسجيل دخول</button>
      <button onclick="location.href='/staff/'">فتح شاشة الفاحص</button>
      <button onclick="location.href='/display/'">فتح شاشة العرض</button>
    </div>

    <hr>

    <button onclick="checkAPI()">تأكد من API</button>
    <span id="apiStatus" class="small"></span>

    <div class="footer">جميع الحقوق محفوظة للرقيب أول يحيى آل عبدالسلام</div>
  </div>
</div>

<script>
document.getElementById("u").textContent = localStorage.getItem("username") || "-";

async function checkAPI(){
  const s = document.getElementById("apiStatus");
  s.textContent = "جارٍ الفحص...";
  try{
    const r = await fetch("/api/health");
    const j = await r.json();
    s.textContent = j.ok ? "✅ جاهز" : "❌ غير جاهز";
  }catch{
    s.textContent = "❌ فشل اتصال";
  }
}
</script>

</body>
</html>
