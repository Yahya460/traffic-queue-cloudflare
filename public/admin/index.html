<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>لوحة المدير</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>

<script>
/* ✅ تحقق صلاحية المدير */
(function () {
  const role = localStorage.getItem("role");
  const username = localStorage.getItem("username");

  if (role !== "admin" || !username) {
    alert("لا تملك صلاحية الدخول كمدير");
    location.href = "/login/";
  }
})();
</script>

<div class="container">
  <div class="card">
    <div class="h1">لوحة المدير</div>

    <p class="small">
      المستخدم: <b id="u"></b> | الصلاحية: <b>admin</b>
    </p>

    <div class="row gap">
      <button onclick="location.href='/display/'">فتح شاشة العرض</button>
      <button onclick="location.href='/staff/'">فتح شاشة الفاحص</button>
      <button onclick="logout()">تسجيل خروج</button>
    </div>

    <hr>

    <p class="small">حالة النظام:</p>
    <button onclick="checkAPI()">تأكد من API</button>
    <span id="apiStatus"></span>

    <div class="footer">
      جميع الحقوق محفوظة للرقيب أول يحيى آل عبدالسلام
    </div>
  </div>
</div>

<script>
document.getElementById("u").textContent =
  localStorage.getItem("username") || "-";

async function checkAPI(){
  const s = document.getElementById("apiStatus");
  s.textContent = "جارٍ الفحص...";
  try {
    const r = await fetch("/api/health");
    const j = await r.json();
    s.textContent = j.ok ? "✅ API يعمل" : "❌ API لا يعمل";
  } catch {
    s.textContent = "❌ فشل الاتصال";
  }
}

function logout(){
  localStorage.clear();
  location.href = "/login/";
}
</script>

</body>
</html>
