<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุชุณุฌูู ุงูุฏุฎูู</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>

<div class="container">
  <div class="card">

    <h2>ุชุณุฌูู ุงูุฏุฎูู</h2>
    <p>ุฎุงุต ุจุงููุฏูุฑ / ุงููุงุญุต</p>

    <label>ุงุณู ุงููุณุชุฎุฏู</label>
    <input id="username" type="text" placeholder="ุงุณู ุงููุณุชุฎุฏู" />

    <label>ูููุฉ ุงููุฑูุฑ</label>
    <input id="password" type="password" placeholder="ูููุฉ ุงููุฑูุฑ" />

    <button id="loginBtn">ุฏุฎูู</button>

    <p id="status" style="margin-top:10px;"></p>

  </div>
</div>

<script>
/* =========================
   API Helper
========================= */
const App = {
  API: {
    async login(username, password) {
      const res = await fetch("/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });
      return await res.json();
    }
  },

  setToken(token) {
    localStorage.setItem("token", token);
  },

  setMe(name, role) {
    localStorage.setItem("name", name);
    localStorage.setItem("role", role);
  },

  setStatus(el, msg, ok) {
    el.textContent = msg;
    el.style.color = ok ? "green" : "red";
  }
};

/* =========================
   Login Logic
========================= */
const u = document.getElementById("username");
const p = document.getElementById("password");
const btn = document.getElementById("loginBtn");
const st = document.getElementById("status");

async function go() {
  try {
    App.setStatus(st, "ุฌุงุฑู ุงูุฏุฎูู ...", true);
    btn.disabled = true;

    const r = await App.API.login(u.value.trim(), p.value);

    if (!r.ok) throw new Error("ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ");

    // ๐น ุงูุชุนุฏูู ุงูููู ููุง
    App.setToken("dummy");          // ูุฃู ุงูู API ูุง ูุฑุฌุน token
    App.setMe(r.name, r.role);      // ุงูุงุณู ุฌุงู ุจุงุณู name

    App.setStatus(st, "ุชู ุชุณุฌูู ุงูุฏุฎูู โ", true);

    if (r.role === "admin") {
      location.href = "/admin/";
    } else {
      location.href = "/staff/";
    }

  } catch (e) {
    App.setStatus(st, "ูุดู ุชุณุฌูู ุงูุฏุฎูู", false);
  } finally {
    btn.disabled = false;
  }
}

btn.addEventListener("click", go);
p.addEventListener("keydown", e => { if (e.key === "Enter") go(); });
</script>

</body>
</html>
