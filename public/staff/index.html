<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Staff</title>
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <h2 style="margin:0">Staff</h2>
      <span class="pill" id="status">...</span>
    </div>

    <div class="card">
      <div class="grid">
        <div class="grid grid2">
          <div>
            <small>Number</small>
            <input id="num" placeholder="12"/>
          </div>
          <div>
            <small>Gender</small>
            <select id="gender">
              <option value="M">Men</option>
              <option value="F">Women</option>
            </select>
          </div>
        </div>
        <div class="row">
          <button id="nextBtn">Next</button>
          <button id="prevBtn">Prev</button>
          <button class="red" id="logoutBtn">Logout</button>
          <a href="/display/">Open Display</a>
        </div>
        <small id="now"></small>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
  <script>
    const statusEl = App.$("#status");
    const nowEl = App.$("#now");
    const numEl = App.$("#num");
    const genderEl = App.$("#gender");

    function requireLogin(){
      const u = App.getUser();
      if(!u) location.href = "/login/";
    }
    requireLogin();

    async function refresh(){
      const s = await App.API.state();
      if(s.ok){
        nowEl.textContent = "Current: " + (s.current?.number ?? "-") + " (" + (s.current?.gender ?? "-") + ")";
        App.setStatus(statusEl, App.getUser().username + " (" + App.getUser().role + ")", "info");
      }else{
        App.setStatus(statusEl, "State error", "warn");
      }
    }

    App.$("#nextBtn").addEventListener("click", async ()=>{
      const n = parseInt(numEl.value, 10);
      if(!Number.isFinite(n)) return alert("Enter a number");
      const r = await App.API.next(n, genderEl.value);
      if(!r.ok) return alert(r.error || "Failed");
      await refresh();
      numEl.value = "";
      numEl.focus();
    });

    App.$("#prevBtn").addEventListener("click", async ()=>{
      const r = await App.API.prev();
      if(!r.ok) return alert(r.error || "Failed");
      await refresh();
    });

    App.$("#logoutBtn").addEventListener("click", async ()=>{
      await App.API.logout();
      location.href = "/login/";
    });

    refresh();
    setInterval(refresh, 1500);
  </script>
</body>
</html>