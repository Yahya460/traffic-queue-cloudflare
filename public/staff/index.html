<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>شاشة الفاحص</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
<div class="container">
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <div class="h1">شاشة الفاحص</div>
        <div class="small" id="me"></div>
      </div>
      <div class="row">
        <a class="pill" href="/display/" target="_blank">فتح شاشة العرض</a>
        <a class="pill" href="/login/">تسجيل دخول</a>
      </div>
    </div>

    <hr>

    <div class="grid grid2">
      <div>
        <div class="small">رقم المتدرب</div>
        <input id="num" inputmode="numeric" placeholder="مثال: 12">
      </div>
      <div>
        <div class="small">النوع</div>
        <select id="gender">
          <option value="male">رجال</option>
          <option value="female">نساء</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <button id="btnNext">نداء</button>
      <button id="btnPrev">السابق</button>
      <span class="pill" id="st">جاهز</span>
    </div>

    <div class="small" style="margin-top:10px">
      ملاحظة: إذا ما نادت النغمة، اضغط زر (نداء) مرة واحدة لتفعيل الصوت في المتصفح.
    </div>

    <div class="footer">جميع الحقوق محفوظة للرقيب أول يحيى آل عبدالسلام</div>
  </div>
</div>

<script src="/app.js"></script>
<script>
  const st = document.getElementById("st");
  const me = document.getElementById("me");
  const num = document.getElementById("num");
  const gender = document.getElementById("gender");

  const who = App.getMe();
  me.textContent = "المستخدم: " + (who.username||"-") + " | الصلاحية: " + (who.role||"-");

  if (!who.role) {
    App.setStatus(st, "غير مسجل دخول", false);
  }

  async function nextCall(){
    try{
      const n = (num.value||"").trim();
      if (!n) return App.setStatus(st, "اكتب رقم المتدرب", false);
      App.setStatus(st, "جاري النداء...", null);
      const r = await App.API.next(n, gender.value);
      if (!r || !r.ok) return App.setStatus(st, "فشل النداء", false);
      App.beep();
      App.setStatus(st, "تم النداء ✅", true);
      num.value = "";
      num.focus();
    }catch(e){
      App.setStatus(st, "فشل النداء", false);
    }
  }

  async function prevCall(){
    try{
      App.setStatus(st, "رجوع...", null);
      const r = await App.API.prev();
      App.setStatus(st, (r && r.ok) ? "تم ✅" : "فشل", !!(r && r.ok));
    }catch(e){
      App.setStatus(st, "فشل", false);
    }
  }

  document.getElementById("btnNext").addEventListener("click", nextCall);
  document.getElementById("btnPrev").addEventListener("click", prevCall);
</script>
</body>
</html>
