<img id="displayImg" style="max-width:100%; max-height:260px; border:1px solid rgba(0,0,0,.15); border-radius:14px; display:none;"><!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Display</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b1220;color:#fff}
    .wrap{padding:18px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .box{border:1px solid rgba(255,255,255,.16);border-radius:18px;padding:16px;background:rgba(255,255,255,.06)}
    .big{font-size:84px;font-weight:900;letter-spacing:2px;line-height:1}
    .sub{opacity:.85;margin-top:8px}
    .ticker{position:fixed;left:0;right:0;bottom:0;padding:14px 18px;background:rgba(255,255,255,.08);border-top:1px solid rgba(255,255,255,.16);font-size:22px}
    img{max-width:100%;border-radius:18px;border:1px solid rgba(255,255,255,.16)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>Display</div>
      <div style="opacity:.8" id="clock">--:--</div>
    </div>

    <div class="box" style="margin-top:14px">
      <div class="big" id="num">-</div>
      <div class="sub" id="meta">Waiting...</div>
    </div>

    <div class="box" style="margin-top:14px">
      <div style="opacity:.8;margin-bottom:10px">Center image</div>
      <img id="img" alt="" style="display:none"/>
      <div id="imgEmpty" style="opacity:.6">No image</div>
    </div>
 <script src="/app.js?v=disp"></script>
<script>
  const displayImg = document.getElementById("displayImg");

  async function refresh(){
    const s = await App.API.state();
    if(!s || !s.ok) return;

    if(s.displayImage){
      displayImg.src = s.displayImage;
      displayImg.style.display = "block";
    }else{
      displayImg.src = "";
      displayImg.style.display = "none";
    }
  }

  refresh();
  setInterval(refresh, 1000); // ✅ هذا اللي يخلي الصفحات تتجاوب
</script> </div>

  <div class="ticker" id="ticker"></div>

  <script src="/app.js"></script>
  <script>
    const numEl = App.$("#num");
    const metaEl = App.$("#meta");
    const tickerEl = App.$("#ticker");
    const clockEl = App.$("#clock");
    const imgEl = App.$("#img");
    const imgEmpty = App.$("#imgEmpty");

    function tickClock(){
      const d = new Date();
      clockEl.textContent = String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
    }
    setInterval(tickClock, 1000); tickClock();

    async function refresh(){
      const s = await App.API.state();
      if(s.ok){
        numEl.textContent = (s.current?.number ?? "-");
        metaEl.textContent = "Gender: " + (s.current?.gender ?? "-") + " • By: " + (s.current?.by ?? "-");
      }
      const t = await App.API.getTicker();
      if(t.ok) tickerEl.textContent = t.text || "";
      const im = await App.API.getCenterImage();
      if(im.ok && im.dataUrl){
        imgEl.src = im.dataUrl;
        imgEl.style.display = "block";
        imgEmpty.style.display = "none";
      }else{
        imgEl.style.display = "none";
        imgEmpty.style.display = "block";
      }
    }
    refresh();
    setInterval(refresh, 1500);
  </script>
</body>
</html>